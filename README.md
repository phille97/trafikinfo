<h1 align="center">
ðŸš¦ Trafikinfo ðŸ¦º
</h1>
<h4 align="center">A Go library for the <a href="https://api.trafikinfo.trafikverket.se/">Trafikinfo API</a> from <a href="https://www.trafikverket.se/">Trafikverket</a></h4>
<p align="center">
    <a href="https://github.com/daenney/trafikinfo/actions/workflows/ci.yml"><img src="https://github.com/daenney/trafikinfo/actions/workflows/ci.yml/badge.svg" alt="Build Status"></a>
	<a href="https://github.com/daenney/trafikinfo/releases"><img src="https://img.shields.io/github/release/daenney/trafikinfo.svg" alt="Release"></a>
    <a href="https://codecov.io/gh/daenney/trafikinfo"><img src="https://codecov.io/gh/daenney/trafikinfo/branch/main/graph/badge.svg" alt="Coverage Status"></a>
    <a href="https://goreportcard.com/report/code.dny.dev/trafikinfo"><img src="https://goreportcard.com/badge/code.dny.dev/trafikinfo" alt="Go report card"></a>
    <a href="https://pkg.go.dev/code.dny.dev/trafikinfo"><img src="https://pkg.go.dev/badge/code.dny.dev/trafikinfo.svg" alt="GoDoc"></a>
    <a href="LICENSE"><img src="https://img.shields.io/github/license/daenney/trafikinfo" alt="License: MIT"></a>
</p>

This library provides the necessary primitives to interact with the
Trafikinfo API. It contains a query builder that can be used to build up a
`Request` object. You can then `xml.Marshal` it and pass it on to your
favourite HTTP client to retrieve it.

The data returned by the [Trafikinfo API is licensed][tl] under [Creative Commons
CC0][cc0].

[tl]: https://api.trafikinfo.trafikverket.se/DynamicContent/ContentDetails/58e384810bb22118e8041667
[cc0]: https://creativecommons.org/publicdomain/zero/1.0/

The API endpoint is available through the `Endpoint` constant. The only
supported endpoint is `v2`, `v1.x` is being deprecated by Trafikverket.

The provided structs in the library have a somewhat odd design in that all
fields are pointers. This happens because the structs are largely
autogenerated from the JSON schema which defines all attributes as optional.
This is a consequence of the `Include` and `Exclude` primitives which can
result in only specific fields being present in the response, or specific
fields be excluded.

## Usage

```go
req, err := trafikinfo.NewRequest().
	APIKey("YOUR_API_KEY").
	Query(
		trafikinfo.NewQuery(
			trafikinfo.WeatherMeasurepoint,
			2.0,
		).Filter(
			trafikinfo.Equal("Name", "YOUR_STATION_NAME"),
		),
	).Build()

if err != nil {
	panic(err)
}

// Rest of the code here to do the request, handle non-200 error
// responses etc.

type respMsg struct {
	Resonpse struct {
		Result []struct {
			WeatherMeasurepoints []trafikinfo.WeatherMeasurepoint2Dot0 `json:"WeatherMeasurepoint"`
			Info           trafikinfo.Info                  `json:"INFO"`
		}
	} `json:"RESPONSE"`
}

var c respMsg
d := json.NewDecoder(resp.Body)
err = d.Decode(&c)

if err != nil {
	panic(err)
}

// Enjoy your struct!
```

More complete code can be found in the `examples/` directory.

Multiple queries can be passed by either passing multiple `NewQuery()` into a
single `Query()` call, or chaining `.Query()` multiple times on the result of
`NewRequest()`.

Calling `.Filter()` multiple times on a `Query` will replace the whole filter,
as a query can only have one filter block.

## Supported object types

This library provides structs for response decoding for the following object
types and versions.

| Object | Versions |
:-- | :-----------
`Camera` | 1.0: âœ…
`FerryAnnouncement` | 1.2: âœ…
`FerryRoute` | 1.2: âœ…
`Icon` | 1.0: âœ…
`MeasurementData100` | 1.0: âœ…
`MeasurementData20` | 1.0: âœ…
`Parking` | 1.0: âœ… 1.4: âœ…
`PavementData` | 1.0: âœ…
`RailCrossing` | 1.4: âœ… 1.5: âœ…
`ReasonCode` | 1.0: âœ…
`RoadCondition` | 1.0: âœ… 1.1: âœ… 1.2: âœ…
`RoadConditionOverview` | 1.0: âœ…
`RoadData` | 1.0: âœ…
`RoadGeometry` | 1.0: âœ…
`Situation` | 1.0: âœ… 1.1: âœ… 1.2: âœ… 1.4: âœ… 1.5: âœ…
`TrafficFlow` | 1.0: âœ… 1.4: âœ…
`TrafficSafetyCamera` | 1.0: âœ…
`TrainAnnouncement` | 1.0: âœ… 1.3: âœ… 1.4: âœ… 1.5: âœ… 1.6: âœ…
`TrainMessage` | 1.0: âœ… 1.3: âœ… 1.4: âœ… 1.5: âœ… 1.6: âœ… 1.7: âœ…
`TrainStation` | 1.0: âœ… 1.4: âœ…
`TrainStationMessage` | 1.0: âœ…
`TravelTimeRoute` | 1.0: âœ… 1.3: âœ… 1.4: âœ… 1.5 âœ…
`WeatherMeasurepoint` | 1.0: âœ… 2.0: âœ…
`WeatherObservation` | 1.0: âœ… 2.0: âœ…
